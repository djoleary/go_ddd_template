#!/usr/bin/env bash
# Pre-commit hook - fast checks only
# dependencies: php git bash grep xargs composer

set -e

echo "ğŸ” Running pre-commit checks..."

# Check if we have staged files
if git diff --cached --quiet; then
    echo "No staged changes found."
    exit 0
fi

# Lint only staged files
echo "ğŸ“ Linting staged files..."
# Get staged Go files
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep '\.go$' || true)

if [ -n "$STAGED_FILES" ]; then
    # Run Go linting on staged files
    go vet "$STAGED_FILES"
    if [ $? -eq 0 ]; then
        echo "âœ… go vet passed"
    else
        echo "âŒ go vet failed"
        exit 1
    fi
else
    echo "â­ï¸ Nothing to lint, skipping..."
fi

echo "ğŸ‰ Pre-commit checks completed successfully!"
